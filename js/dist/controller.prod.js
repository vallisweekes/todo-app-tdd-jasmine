"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}!function(e){var t=function(){function o(e,t){var i=this;_classCallCheck(this,o),this.model=e,this.view=t,console.log("What is this doing",t),this.view.bind("newTodo",function(e){i.addItem(e)}),this.view.bind("itemEdit",function(e){i.editItem(e.id)}),this.view.bind("itemEditDone",function(e){i.editItemSave(e.id,e.title)}),this.view.bind("itemEditCancel",function(e){i.editItemCancel(e.id)}),this.view.bind("itemRemove",function(e){i.removeItem(e.id)}),this.view.bind("itemToggle",function(e){i.toggleComplete(e.id,e.completed)}),this.view.bind("removeCompleted",function(){i.removeCompletedItems()}),this.view.bind("toggleAll",function(e){i.toggleAll(e.completed)})}return _createClass(o,[{key:"setView",value:function(e){var t=e.split("/")[1]||"";this._updateFilterState(t)}},{key:"showAll",value:function(){var t=this;t.model.read(function(e){t.view.render("showEntries",e)})}},{key:"showActive",value:function(){var t=this;this.model.read({completed:!1},function(e){t.view.render("showEntries",e)})}},{key:"showCompleted",value:function(){var t=this,i=this;i.model.read({completed:!0},function(e){console.log(i),t.view.render("showEntries",e)})}},{key:"addItem",value:function(e){var t=this;""!==e.trim()&&t.model.create(e,function(){t.view.render("clearNewTodo"),t._filter(!0)})}},{key:"editItem",value:function(t){var i=this;i.model.read(t,function(e){i.view.render("editItem",{id:t,title:e[0].title})})}},{key:"editItemSave",value:function(e,t){for(var i=this;" "===t[0];)t=t.slice(1);for(;" "===t[t.length-1];)t=t.slice(0,-1);0!==t.length?i.model.update(e,{title:t},function(){i.view.render("editItemDone",{id:e,title:t})}):i.removeItem(e)}},{key:"editItemCancel",value:function(t){var i=this;i.model.read(t,function(e){i.view.render("editItemDone",{id:t,title:e[0].title})})}},{key:"removeItem",value:function(t){var i,e=this;e.model.read(function(e){i=e}),i.forEach(function(e){if(e.id===t)return t}),e.model.remove(t,function(){e.view.render("removeItem",t)}),e._filter()}},{key:"removeCompletedItems",value:function(){var t=this;t.model.read({completed:!0},function(e){e.forEach(function(e){t.removeItem(e.id)})}),t._filter()}},{key:"toggleComplete",value:function(e,t,i){var o=this;o.model.update(e,{completed:t},function(){o.view.render("elementComplete",{id:e,completed:t})}),i||o._filter()}},{key:"toggleAll",value:function(t){var i=this;i.model.read({completed:!t},function(e){console.log(t),e.forEach(function(e){i.toggleComplete(e.id,t,!0)})}),i._filter()}},{key:"_updateCount",value:function(){var t=this;t.model.getCount(function(e){t.view.render("updateElementCount",e.active),t.view.render("clearCompletedButton",{completed:e.completed,visible:0<e.completed}),t.view.render("toggleAll",{checked:e.completed===e.total}),t.view.render("contentBlockVisibility",{visible:0<e.total})})}},{key:"_filter",value:function(e){var t=this._activeRoute.charAt(0).toUpperCase()+this._activeRoute.substr(1);this._updateCount(),!e&&"All"===this._lastActiveRoute&&this._lastActiveRoute===t||this["show"+t](),this._lastActiveRoute=t}},{key:"_updateFilterState",value:function(e){""===(this._activeRoute=e)&&(this._activeRoute="All"),this._filter(),this.view.render("setFilter",e)}}]),o}();e.app=e.app||{},e.app.Controller=t}(window);